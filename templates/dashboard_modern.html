{% extends "base_modern.html" %}

{% block title %}Dashboard - Auditoria FB{% endblock %}

{% block extra_css %}
<style>
    /* Specific Dashboard Styles */
    .metric-mini-chart {
        height: 40px;
        opacity: 0.6;
    }
    
    .chart-container {
        position: relative;
        height: 300px;
    }
    
    .stat-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 16px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        font-size: 0.875rem;
    }
    
    .activity-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .activity-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header Section -->
    <div style="margin-bottom: 32px;">
        <h1 style="font-size: 1.875rem; font-weight: 800; margin: 0 0 8px 0;">Dashboard Overview</h1>
        <div style="display: flex; align-items: center; gap: 24px;">
            <div class="stat-pill">
                <i class="fas fa-calendar"></i>
                <span id="currentDate">{{ current_date }}</span>
            </div>
            <div class="stat-pill">
                <div style="width: 8px; height: 8px; background: var(--success); border-radius: 50%; animation: pulse 2s infinite;"></div>
                <span>Sistema Online</span>
            </div>
        </div>
    </div>
    
    <!-- Main Metrics Grid -->
    <div class="dashboard-grid" style="margin-bottom: 32px;">
        <!-- Faturamento -->
        <div class="col-span-3">
            <div class="card-modern metric-card-modern glass">
                <div class="metric-header">
                    <div class="metric-icon primary">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <canvas id="sparkline1" class="metric-mini-chart" width="120" height="40"></canvas>
                </div>
                <p class="metric-label">Faturamento Total</p>
                <h2 class="metric-value" id="totalRevenue">R$ 0</h2>
                <div class="metric-footer">
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+15.3%</span>
                    </div>
                    <span style="font-size: 0.75rem; opacity: 0.6;">vs. mês anterior</span>
                </div>
            </div>
        </div>
        
        <!-- Vendas -->
        <div class="col-span-3">
            <div class="card-modern metric-card-modern glass">
                <div class="metric-header">
                    <div class="metric-icon success">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <canvas id="sparkline2" class="metric-mini-chart" width="120" height="40"></canvas>
                </div>
                <p class="metric-label">Total de Vendas</p>
                <h2 class="metric-value" id="totalSales">0</h2>
                <div class="metric-footer">
                    <div class="metric-change negative">
                        <i class="fas fa-arrow-down"></i>
                        <span>-2.1%</span>
                    </div>
                    <span style="font-size: 0.75rem; opacity: 0.6;">vs. mês anterior</span>
                </div>
            </div>
        </div>
        
        <!-- Ticket Médio -->
        <div class="col-span-3">
            <div class="card-modern metric-card-modern glass">
                <div class="metric-header">
                    <div class="metric-icon warning">
                        <i class="fas fa-receipt"></i>
                    </div>
                    <canvas id="sparkline3" class="metric-mini-chart" width="120" height="40"></canvas>
                </div>
                <p class="metric-label">Ticket Médio</p>
                <h2 class="metric-value" id="avgTicket">R$ 0</h2>
                <div class="metric-footer">
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+5.7%</span>
                    </div>
                    <span style="font-size: 0.75rem; opacity: 0.6;">vs. mês anterior</span>
                </div>
            </div>
        </div>
        
        <!-- Taxa de Conversão -->
        <div class="col-span-3">
            <div class="card-modern metric-card-modern glass">
                <div class="metric-header">
                    <div class="metric-icon info">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div style="position: relative; width: 80px; height: 80px;">
                        <svg class="progress-circle" viewBox="0 0 36 36">
                            <path class="progress-circle-bg"
                                d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831"
                                stroke-dasharray="100, 100"/>
                            <path class="progress-circle-fill"
                                style="stroke: var(--info);"
                                d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831"
                                stroke-dasharray="82, 100"/>
                        </svg>
                        <div class="progress-circle-text" style="font-size: 1.125rem;">82%</div>
                    </div>
                </div>
                <p class="metric-label">Taxa de Conversão</p>
                <h2 class="metric-value" style="font-size: 1.875rem;">82%</h2>
                <div class="metric-footer">
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+3.2%</span>
                    </div>
                    <span style="font-size: 0.75rem; opacity: 0.6;">eficiência</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts Section -->
    <div class="dashboard-grid" style="margin-bottom: 32px;">
        <!-- Revenue Chart -->
        <div class="col-span-8">
            <div class="card-modern glass" style="padding: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 700; margin: 0;">Evolução de Faturamento</h3>
                        <p style="font-size: 0.875rem; opacity: 0.6; margin: 4px 0 0 0;">Últimos 30 dias</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-modern ghost" style="padding: 8px 16px; font-size: 0.75rem;">Diário</button>
                        <button class="btn-modern primary" style="padding: 8px 16px; font-size: 0.75rem;">Mensal</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Top Products -->
        <div class="col-span-4">
            <div class="card-modern glass" style="padding: 24px;">
                <h3 style="font-size: 1.125rem; font-weight: 700; margin: 0 0 24px 0;">Top Produtos</h3>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div class="activity-item">
                        <div class="activity-icon" style="background: rgba(0, 212, 255, 0.15);">
                            <i class="fas fa-beer" style="color: var(--primary);"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">Heineken 600ml</div>
                            <div style="font-size: 0.75rem; opacity: 0.6;">1.847 vendas</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 700;">R$ 36.9k</div>
                            <div class="tag success" style="font-size: 0.625rem;">+12%</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon" style="background: rgba(0, 255, 136, 0.15);">
                            <i class="fas fa-cocktail" style="color: var(--success);"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">Gin Tônica</div>
                            <div style="font-size: 0.75rem; opacity: 0.6;">1.523 vendas</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 700;">R$ 34.3k</div>
                            <div class="tag success" style="font-size: 0.625rem;">+8%</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon" style="background: rgba(255, 184, 0, 0.15);">
                            <i class="fas fa-beer" style="color: var(--warning);"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">Corona Extra</div>
                            <div style="font-size: 0.75rem; opacity: 0.6;">1.389 vendas</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 700;">R$ 27.8k</div>
                            <div class="tag danger" style="font-size: 0.625rem;">-3%</div>
                        </div>
                    </div>
                    
                    <div class="activity-item" style="border: none;">
                        <div class="activity-icon" style="background: rgba(123, 97, 255, 0.15);">
                            <i class="fas fa-wine-glass" style="color: var(--info);"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">Aperol Spritz</div>
                            <div style="font-size: 0.75rem; opacity: 0.6;">1.245 vendas</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 700;">R$ 31.1k</div>
                            <div class="tag success" style="font-size: 0.625rem;">+15%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bottom Section -->
    <div class="dashboard-grid">
        <!-- Categories Performance -->
        <div class="col-span-6">
            <div class="card-modern glass" style="padding: 24px;">
                <h3 style="font-size: 1.125rem; font-weight: 700; margin: 0 0 24px 0;">Performance por Categoria</h3>
                <div class="chart-container" style="height: 250px;">
                    <canvas id="categoriesChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Units Performance -->
        <div class="col-span-6">
            <div class="card-modern glass" style="padding: 24px;">
                <h3 style="font-size: 1.125rem; font-weight: 700; margin: 0 0 24px 0;">Performance por Unidade</h3>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">BB Centro</span>
                            <span style="font-weight: 700;">R$ 458k</span>
                        </div>
                        <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: 92%; background: linear-gradient(90deg, var(--primary), var(--info)); border-radius: 4px;"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">Blue Note</span>
                            <span style="font-weight: 700;">R$ 387k</span>
                        </div>
                        <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: 78%; background: linear-gradient(90deg, var(--success), var(--primary)); border-radius: 4px;"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">BB Granja</span>
                            <span style="font-weight: 700;">R$ 313k</span>
                        </div>
                        <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: 65%; background: linear-gradient(90deg, var(--warning), var(--danger)); border-radius: 4px;"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">Arcos</span>
                            <span style="font-weight: 700;">R$ 278k</span>
                        </div>
                        <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: 56%; background: linear-gradient(90deg, var(--warning), var(--info)); border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Set current date
document.getElementById('currentDate').textContent = new Date().toLocaleDateString('pt-BR', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
});

// Initialize values with animation
function animateValue(id, start, end, duration, prefix = '', suffix = '') {
    const obj = document.getElementById(id);
    const range = end - start;
    const minTimer = 50;
    let stepTime = Math.abs(Math.floor(duration / range));
    stepTime = Math.max(stepTime, minTimer);
    const startTime = new Date().getTime();
    const endTime = startTime + duration;
    
    function run() {
        const now = new Date().getTime();
        const remaining = Math.max((endTime - now) / duration, 0);
        const value = Math.round(end - (remaining * range));
        
        if (prefix === 'R$ ') {
            obj.textContent = formatarValorAbreviado(value);
        } else if (suffix === 'k') {
            obj.textContent = formatarNumeroAbreviado(value * 1000);
        } else {
            obj.textContent = prefix + value.toLocaleString('pt-BR') + suffix;
        }
        
        if (value !== end) {
            requestAnimationFrame(run);
        }
    }
    
    requestAnimationFrame(run);
}

// Load data
document.addEventListener('DOMContentLoaded', function() {
    // Animate metrics
    animateValue('totalRevenue', 0, 1584320, 1500, 'R$ ');
    animateValue('totalSales', 0, 12847, 1500);
    animateValue('avgTicket', 0, 123, 1500, 'R$ ');
    
    // Mini sparklines
    const sparklineData1 = [45, 52, 48, 58, 62, 75, 68, 72, 78, 82, 79, 85];
    const sparklineData2 = [120, 135, 125, 140, 138, 142, 145, 139, 143, 141, 146, 148];
    const sparklineData3 = [95, 98, 102, 108, 112, 115, 118, 122, 119, 123, 125, 123];
    
    drawSparkline('sparkline1', sparklineData1, '#00D4FF');
    drawSparkline('sparkline2', sparklineData2, '#00FF88');
    drawSparkline('sparkline3', sparklineData3, '#FFB800');
    
    // Main Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    const gradient = revenueCtx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, 'rgba(0, 212, 255, 0.3)');
    gradient.addColorStop(1, 'rgba(0, 212, 255, 0)');
    
    new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: Array.from({length: 30}, (_, i) => i + 1),
            datasets: [{
                label: 'Faturamento',
                data: Array.from({length: 30}, () => 45000 + Math.random() * 35000),
                borderColor: '#00D4FF',
                backgroundColor: gradient,
                borderWidth: 3,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 6,
                pointHoverBackgroundColor: '#00D4FF',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    titleFont: { size: 14, weight: '600' },
                    bodyFont: { size: 16, weight: '700' },
                    callbacks: {
                        label: function(context) {
                            return 'R$ ' + context.parsed.y.toLocaleString('pt-BR');
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { color: 'rgba(255, 255, 255, 0.5)' }
                },
                y: {
                    grid: { 
                        color: 'rgba(255, 255, 255, 0.05)',
                        drawBorder: false
                    },
                    ticks: { 
                        color: 'rgba(255, 255, 255, 0.5)',
                        callback: function(value) {
                            return formatarValorAbreviado(value);
                        }
                    }
                }
            }
        }
    });
    
    // Categories Chart
    const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
    new Chart(categoriesCtx, {
        type: 'doughnut',
        data: {
            labels: ['Cervejas', 'Drinks', 'Petiscos', 'Vinhos', 'Destilados'],
            datasets: [{
                data: [35, 25, 20, 12, 8],
                backgroundColor: [
                    '#00D4FF',
                    '#00FF88',
                    '#FFB800',
                    '#FF3366',
                    '#7B61FF'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {
                        color: 'rgba(255, 255, 255, 0.8)',
                        padding: 16,
                        font: { size: 12 }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.parsed + '%';
                        }
                    }
                }
            }
        }
    });
});

// Sparkline drawing function
function drawSparkline(canvasId, data, color) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const max = Math.max(...data);
    const min = Math.min(...data);
    const range = max - min;
    const step = width / (data.length - 1);
    
    ctx.beginPath();
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.globalAlpha = 0.8;
    
    data.forEach((value, index) => {
        const x = index * step;
        const y = height - ((value - min) / range) * height;
        
        if (index === 0) {
            ctx.moveTo(x, y);
        } else {
            ctx.lineTo(x, y);
        }
    });
    
    ctx.stroke();
}
</script>
{% endblock %}